javascript:(function(){"use strict";var H="69f9de93-7dc3-48aa-9050-4c395406d344-00-3uat6a5ciur3j.riker.replit.dev",P=["/assistant","/api/assistant","/agent","/api/agent","/eidolon","/api/eidolon"],V={assistant:"/api/assistant/verify-override",agent:"/api/agent/verify-override",eidolon:"/api/assistant/verify-override"},EN=!/[?&]no-override=1(?:&|$)/.test(location.search),STRICT=!0;if(!EN){console.warn("[eidolon] disabled via ?no-override=1");return}var ORIG={fetch:window.fetch?window.fetch.bind(window):null,XHR_open:XMLHttpRequest&&XMLHttpRequest.prototype.open,XHR_send:XMLHttpRequest&&XMLHttpRequest.prototype.send,EventSource:window.EventSource||null,WebSocket:window.WebSocket||null};function kind(p){try{if(!p||typeof p!=="string")return null;var s=p.replace(/\/{2,}/g,"/");if(s.indexOf("/api/assistant")===0||s.indexOf("/assistant")===0)return"assistant";if(s.indexOf("/api/agent")===0||s.indexOf("/agent")===0)return"agent";if(s.indexOf("/api/eidolon")===0||s.indexOf("/eidolon")===0)return"eidolon";return null}catch(e){return null}}function hits(path){try{return P.some(function(x){return path.indexOf(x)===0})}catch(e){return!1}}function proto(ws){var https=location.protocol==="https:";return ws?https?"wss:":"ws:":https?"https:":"http:"}function rewrite(input,forWS){if(forWS!==!0)forWS=!1;try{var u=new URL(input,location.href);if(!hits(u.pathname))return null;if(u.host===H)return null;u.host=H;u.protocol=proto(forWS);return u.toString()}catch(e){return null}}function log(kind,detail){try{console.log("[eidolon]",kind,detail);window.__EIDOLON_LAST_EVENT={kind:kind,detail:detail,ts:Date.now()}}catch(e){}}function extract(arr){var out=[];if(!Array.isArray(arr))return out;for(var i=0;i<arr.length;i++){var m=arr[i];if(!m)continue;var t="";if(typeof m==="string")t=m;else if(m.text)t=m.text;else if(m.content&&typeof m.content==="string")t=m.content;else if(Array.isArray(m.content))for(var j=0;j<m.content.length;j++){var p=m.content[j];if(p&&typeof p.text==="string")t+=(t?" ":"")+p.text;else if(p&&typeof p==="string")t+=(t?" ":"")+p}if(t)out.push(t)}return out}function printUser(bodyObj,meta){try{var msgs=[];if(Array.isArray(bodyObj&&bodyObj.messages))msgs=extract(bodyObj.messages);else if(bodyObj&&bodyObj.input&&Array.isArray(bodyObj.input.messages))msgs=extract(bodyObj.input.messages);else if(typeof(bodyObj&&bodyObj.input)==="string")msgs=[String(bodyObj.input)];if(!msgs.length)return;console.log("[userâ†’"+(meta&&meta.kind?meta.kind:"service")+"]",msgs.join(" ").slice(0,12000),meta||"")}catch(e){}}function hdrsFor(k){var h={"X-Eidolon-Override":"1","X-Assistant-Override":"1","X-Agent-Override":"1"};if(k==="assistant")h["X-Override-Target"]="assistant";else if(k==="agent")h["X-Override-Target"]="agent";else if(k==="eidolon")h["X-Override-Target"]="eidolon";return h}function setHeaders(existing,k){var h=new Headers(existing||void 0),x=hdrsFor(k);for(var n in x){try{h.set(n,x[n])}catch(e){}}return h}function cloneInit(init,h){var o=Object.assign({},init||{});o.headers=h;if(o.credentials)delete o.credentials;return o}function tapBody(initOrInput,url,method,k){try{var raw=(initOrInput&&initOrInput.body)||null;if(raw&&typeof raw==="string"){try{var parsed=JSON.parse(raw);printUser(parsed,{method:method,url:url,kind:k})}catch(e){}}}catch(e){}}function verifyAll(){function ping(u,tag){try{var img=new Image(),done=!1,to=setTimeout(function(){if(done)return;done=!0;window.__EIDOLON_OVERRIDE_VERIFIED=window.__EIDOLON_OVERRIDE_VERIFIED||{};window.__EIDOLON_OVERRIDE_VERIFIED[tag]=!1;log("verify_timeout",{url:u,tag:tag})},1500);img.onload=img.onerror=function(){if(done)return;done=!0;clearTimeout(to);window.__EIDOLON_OVERRIDE_VERIFIED=window.__EIDOLON_OVERRIDE_VERIFIED||{};window.__EIDOLON_OVERRIDE_VERIFIED[tag]=!0;log("verify_ok",{url:u,tag:tag})};img.src=u+(u.indexOf("?")===-1?"?":"&")+"t="+Date.now()}catch(e){window.__EIDOLON_OVERRIDE_VERIFIED=window.__EIDOLON_OVERRIDE_VERIFIED||{};window.__EIDOLON_OVERRIDE_VERIFIED[tag]=null;log("verify_error",{error:String(e),tag:tag})}}var base=proto(!1)+"//"+H;ping(base+V.assistant,"assistant");ping(base+V.agent,"agent");ping(base+V.eidolon,"eidolon")}window.__EIDOLON_STATUS_FN=function(){var v=window.__EIDOLON_OVERRIDE_VERIFIED,ok=v&&typeof v==="object"?(!!(v.assistant||v.agent||v.eidolon)):!!v;return{host:H,paths:P.slice(),verified:ok,perService:v||null,last:window.__EIDOLON_LAST_EVENT||null}};window.eidolonStatus=window.__EIDOLON_STATUS_FN;try{var s=document.createElement("script");s.appendChild(document.createTextNode("function eidolonStatus(){return window.__EIDOLON_STATUS_FN.apply(this,arguments)}"));document.documentElement.appendChild(s);s.parentNode.removeChild(s)}catch(e){}if(ORIG.fetch)window.fetch=function(input,init){var url=typeof input==="string"?input:(input&&input.url),method=(init&&init.method)||(input&&input.method)||"GET",k=null;try{var u=new URL(url||"",location.href);k=kind(u.pathname)}catch(e){}try{var r=url&&rewrite(url,!1);if(!r)return ORIG.fetch(input,init);var base=(init&&init.headers)||(input&&input.headers)||void 0,headers=setHeaders(base,k||"eidolon"),opts=cloneInit(init,headers);tapBody(opts,r,method,k||"eidolon");log("fetch",{method:method,kind:k,originalUrl:url,overrideUrl:r});return ORIG.fetch(r,opts)}catch(err){log("fetch_error",{error:String(err),url:url,kind:k});return ORIG.fetch(input,init)}};if(ORIG.XHR_open)XMLHttpRequest.prototype.open=function(m,u,a,b,c){try{var r=rewrite(u,!1);if(r){log("xhr_open",{method:m,originalUrl:u,overrideUrl:r});return ORIG.XHR_open.call(this,m,r,a,b,c)}}catch(e){log("xhr_open_error",{error:String(e),url:u})}return ORIG.XHR_open.call(this,m,u,a,b,c)};if(ORIG.XHR_send)XMLHttpRequest.prototype.send=function(body){try{var k=null;try{var u=new URL(this.responseURL||this._url||"",location.href);k=kind(u.pathname)||"eidolon"}catch(e){k="eidolon"}var h=hdrsFor(k);for(var n in h){try{this.setRequestHeader(n,h[n])}catch(e){}}}catch(e){}if(body&&typeof body==="string"){try{var parsed=JSON.parse(body);printUser(parsed,{method:"XHR",kind:"eidolon"})}catch(e){}}return ORIG.XHR_send.call(this,body)};if(ORIG.EventSource)window.EventSource=function(u,cfg){var r=rewrite(u,!1);if(r){log("eventsource",{originalUrl:u,overrideUrl:r});return new ORIG.EventSource(r,cfg)}return new ORIG.EventSource(u,cfg)};if(ORIG.WebSocket)window.WebSocket=function(u,prot){var r=rewrite(u,!0);if(r){log("websocket",{originalUrl:u,overrideUrl:r});return new ORIG.WebSocket(r,prot)}return new ORIG.WebSocket(u,prot)};verifyAll();log("init",{host:H,paths:P,strict:STRICT,proto:location.protocol})})();
