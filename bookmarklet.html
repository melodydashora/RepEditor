<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eidolon Override Bookmarklet</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      line-height: 1.6;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-top: 0;
    }
    .bookmarklet {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 30px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      margin: 20px 0;
      cursor: move;
      transition: transform 0.2s;
    }
    .bookmarklet:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .instructions {
      background: #f0f9ff;
      border-left: 4px solid #2563eb;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .paths {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      margin: 15px 0;
    }
    .paths ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    .status {
      background: #10b981;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      margin: 15px 0;
    }
    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ Eidolon Override Bookmarklet</h1>
    
    <div class="instructions">
      <strong>üìã How to Install:</strong>
      <ol>
        <li>Show your bookmarks bar (Ctrl+Shift+B / Cmd+Shift+B)</li>
        <li>Drag the blue button below to your bookmarks bar</li>
        <li>Navigate to vectopilot.com</li>
        <li>Click the bookmarklet in your bookmarks bar</li>
      </ol>
    </div>

    <div style="text-align: center; margin: 30px 0;">
      <a href='javascript: (function(){ "use strict"; var GATEWAY_HOST = "69f9de93-7dc3-48aa-9050-4c395406d344-00-3uat6a5ciur3j.riker.replit.dev"; var PATH_PREFIXES = ["/assistant", "/api/assistant", "/agent", "/api/agent", "/eidolon", "/api/eidolon"]; var VERIFY = "/api/assistant/verify-override"; var ENABLED = !/[?&]no-override=1(?:&|$)/.test(location.search); var STRICT = true; if (!ENABLED) { console.warn("[eidolon] disabled via ?no-override=1"); return; } var ORIG = { fetch: window.fetch ? window.fetch.bind(window) : null, XHR_open: XMLHttpRequest && XMLHttpRequest.prototype.open, XHR_send: XMLHttpRequest && XMLHttpRequest.prototype.send, EventSource: window.EventSource || null, WebSocket: window.WebSocket || null }; function isAssistantPath(pathname){ try { return PATH_PREFIXES.some(function(p){ return pathname.indexOf(p) === 0; }); } catch(e){ return false; } } function tryRewriteURL(input, forWS){ if (forWS !== true) forWS = false; try { var u = new URL(input, location.href); if (!isAssistantPath(u.pathname)) return null; if (u.host === GATEWAY_HOST) return null; u.host = GATEWAY_HOST; u.protocol = forWS ? "wss:" : "https:"; return u.toString(); } catch(e){ return null; } } function logEvent(kind, detail){ try { console.log("[eidolon]", kind, detail); window.__EIDOLON_LAST_EVENT = { kind: kind, detail: detail, ts: Date.now() }; } catch(e){} } function printUserMessages(messages, meta){ try { if (!messages || !messages.length) return; for (var i=0; i<messages.length; i++){ var m = messages[i]; if (!m) continue; var text = ""; if (typeof m === "string") text = m; else if (m.text) text = m.text; else if (m.content && typeof m.content === "string") text = m.content; else if (Array.isArray(m.content)) { for (var j=0;j<m.content.length;j++){ var p = m.content[j]; if (p && typeof p.text === "string") { text += (text ? " " : "") + p.text; } else if (p && typeof p === "string") { text += (text ? " " : "") + p; } } } var printable = (text || "").slice(0, 12000); console.log("[user‚Üíassistant]", printable, meta || ""); } } catch(e){ console.warn("[eidolon] printUserMessages error", e); } } function verifyOverride(){ try { var url = "https://" + GATEWAY_HOST + VERIFY + "?t=" + Date.now(); var img = new Image(), done = false; var timeout = setTimeout(function(){ if (done) return; done = true; window.__EIDOLON_OVERRIDE_VERIFIED = false; logEvent("verify_timeout", { url: url }); }, 1500); img.onload = img.onerror = function(){ if (done) return; done = true; clearTimeout(timeout); window.__EIDOLON_OVERRIDE_VERIFIED = true; logEvent("verify_ok", { url: url }); }; img.src = url; } catch(e){ window.__EIDOLON_OVERRIDE_VERIFIED = null; logEvent("verify_error", { error: String(e) }); } } window.eidolonStatus = function(){ return { host: GATEWAY_HOST, paths: PATH_PREFIXES, verified: !!window.__EIDOLON_OVERRIDE_VERIFIED, last: window.__EIDOLON_LAST_EVENT || null }; }; if (ORIG.fetch){ window.fetch = function(input, init){ try { var url = typeof input === "string" ? input : (input && input.url); var rewritten = url && tryRewriteURL(url, false); var method = (init && init.method) || (input && input.method) || "GET"; if (!rewritten) return ORIG.fetch(input, init); var baseHeaders = (init && init.headers) || (input && input.headers) || void 0; var headers = new Headers(baseHeaders || void 0); try { headers.set("X-Assistant-Override", "1"); } catch(headerErr){} var opts = Object.assign({}, init || {}); opts.headers = headers; if (opts.credentials){ delete opts.credentials; } var body = opts.body; if (body && typeof body === "string"){ try { var parsed = JSON.parse(body); if (parsed && Array.isArray(parsed.messages)){ printUserMessages(parsed.messages, { method: method, url: rewritten }); } } catch(parseErr){} } logEvent("fetch", { method: method, originalUrl: url, overrideUrl: rewritten }); return ORIG.fetch(rewritten, opts); } catch(err){ logEvent("fetch_error", { error: String(err), url: url }); return ORIG.fetch(input, init); } }; } if (ORIG.XHR_open){ XMLHttpRequest.prototype.open = function(method, url, async, user, password){ try { var rewritten = tryRewriteURL(url, false); if (rewritten){ logEvent("xhr_open", { method: method, originalUrl: url, overrideUrl: rewritten }); return ORIG.XHR_open.call(this, method, rewritten, async, user, password); } } catch(e){ logEvent("xhr_open_error", { error: String(e), url: url }); } return ORIG.XHR_open.call(this, method, url, async, user, password); }; } if (ORIG.XHR_send){ XMLHttpRequest.prototype.send = function(body){ try { this.setRequestHeader("X-Assistant-Override", "1"); } catch(e){} if (body && typeof body === "string"){ try { var parsed = JSON.parse(body); if (parsed && Array.isArray(parsed.messages)){ printUserMessages(parsed.messages, { method: "XHR" }); } } catch(parseErr){} } return ORIG.XHR_send.call(this, body); }; } if (ORIG.EventSource){ window.EventSource = function(url, config){ var rewritten = tryRewriteURL(url, false); if (rewritten){ logEvent("eventsource", { originalUrl: url, overrideUrl: rewritten }); return new ORIG.EventSource(rewritten, config); } return new ORIG.EventSource(url, config); }; } if (ORIG.WebSocket){ window.WebSocket = function(url, protocols){ var rewritten = tryRewriteURL(url, true); if (rewritten){ logEvent("websocket", { originalUrl: url, overrideUrl: rewritten }); return new ORIG.WebSocket(rewritten, protocols); } return new ORIG.WebSocket(url, protocols); }; } verifyOverride(); logEvent("init", { host: GATEWAY_HOST, paths: PATH_PREFIXES, strict: STRICT }); alert("‚úÖ Eidolon Override Active!\n\nHost: " + GATEWAY_HOST + "\n\nPaths intercepted:\n" + PATH_PREFIXES.join("\n") + "\n\nCheck console for details."); })();' class="bookmarklet">
        üéØ Eidolon Override
      </a>
      <p style="color: #6b7280; margin-top: 10px; font-size: 14px;">
        ‚¨ÜÔ∏è Drag this to your bookmarks bar
      </p>
    </div>

    <div class="paths">
      <strong>üîÑ Intercepted Paths:</strong>
      <ul>
        <li><code>/assistant</code></li>
        <li><code>/api/assistant</code></li>
        <li><code>/agent</code> ‚ú® <em>NEW</em></li>
        <li><code>/api/agent</code> ‚ú® <em>NEW</em></li>
        <li><code>/eidolon</code> ‚ú® <em>NEW</em></li>
        <li><code>/api/eidolon</code> ‚ú® <em>NEW</em></li>
      </ul>
    </div>

    <div class="status">
      <strong>‚úÖ What This Does:</strong>
      <ul style="margin: 10px 0; padding-left: 20px;">
        <li>Redirects all Assistant API calls to your dev environment</li>
        <li>Redirects all Agent API calls to your dev environment</li>
        <li>Redirects all Eidolon API calls to your dev environment</li>
        <li>Adds <code>X-Assistant-Override: 1</code> header for authentication</li>
        <li>Logs all intercepted requests to console</li>
        <li>Works with Fetch, XHR, WebSocket, and EventSource</li>
      </ul>
    </div>

    <div class="instructions" style="background: #fef3c7; border-left-color: #f59e0b;">
      <strong>üß™ Testing:</strong>
      <ol>
        <li>After clicking the bookmarklet, open DevTools (F12)</li>
        <li>Check console for <code>[eidolon]</code> logs</li>
        <li>Run <code>eidolonStatus()</code> in console to verify</li>
        <li>Make an API request and watch it get intercepted</li>
      </ol>
    </div>

    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
      <p style="color: #6b7280; font-size: 14px;">
        <strong>Gateway Host:</strong> <code>69f9de93-7dc3-48aa-9050-4c395406d344-00-3uat6a5ciur3j.riker.replit.dev</code><br>
        <strong>Disable:</strong> Add <code>?no-override=1</code> to URL
      </p>
    </div>
  </div>
</body>
</html>
