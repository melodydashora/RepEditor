<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>SVG Editor</title>
  <style>
    :root{--bg:#0b1220;--pane:#0f172a;--line:#24314f;--fg:#e2e8f0;--accent:#93c5fd}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:14px/1.6 system-ui}
    .header{padding:12px 16px;background:var(--pane);border-bottom:1px solid var(--line);display:flex;align-items:center;gap:12px}
    .viewer{padding:20px;height:calc(100% - 56px);overflow:auto;display:flex;align-items:center;justify-content:center}
    .svg-container{background:white;border-radius:8px;padding:20px;box-shadow:0 4px 6px rgba(0,0,0,0.3)}
    .controls{position:fixed;top:70px;right:20px;background:var(--pane);padding:12px;border-radius:8px;border:1px solid var(--line)}
    .control-btn{display:block;width:100%;margin:4px 0;padding:6px 12px;background:#1d4ed8;color:white;border:none;border-radius:4px;cursor:pointer}
    .control-btn:hover{background:#1e40af}
    pre{background:var(--pane);padding:12px;border-radius:8px;overflow:auto;max-height:300px}
  </style>
</head>
<body>
  <div class="header">
    <h1 style="margin:0;font-size:18px">üìê SVG Editor</h1>
    <span id="filename" style="opacity:0.7;font-size:13px">Open any .svg file from the file tree</span>
  </div>
  <div class="viewer" id="viewer">
    <div style="text-align:center;opacity:0.6">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
        <circle cx="8.5" cy="8.5" r="1.5"/>
        <polyline points="21 15 16 10 5 21"/>
      </svg>
      <p>Select an SVG file to view/edit</p>
    </div>
  </div>
  <script type="module">
    let ext=null; try{ext=await import("@replit/extensions")}catch{}
    const {experimental} = ext || {}; const {fs} = experimental || {};
    const viewer = document.getElementById("viewer");
    const filename = document.getElementById("filename");
    
    async function loadSVG() {
      const path = new URL(location.href).searchParams.get("path");
      if (!path || !fs?.readFile) return;
      
      filename.textContent = path;
      try {
        const buf = await fs.readFile(path);
        const content = new TextDecoder().decode(buf);
        viewer.innerHTML = `
          <div class="svg-container">${content}</div>
          <div class="controls">
            <button class="control-btn" onclick="toggleSource()">View Source</button>
            <button class="control-btn" onclick="downloadSVG()">Download</button>
          </div>
          <pre id="source" style="display:none;margin-top:20px">${content.replace(/</g,'&lt;')}</pre>
        `;
        
        window.toggleSource = () => {
          const src = document.getElementById("source");
          src.style.display = src.style.display === "none" ? "block" : "none";
        };
        
        window.downloadSVG = () => {
          const blob = new Blob([content], {type: "image/svg+xml"});
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = path.split("/").pop();
          a.click();
        };
      } catch(e) {
        viewer.innerHTML = `<div style="color:#ef4444">Error loading SVG: ${e.message}</div>`;
      }
    }
    loadSVG();
  </script>
</body>
</html>